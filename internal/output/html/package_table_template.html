<table class="vuln-table">
  <tr>
    <th></th>
    <th>Package</th>
    <th>Ecosystem</th>
    <th>Installed version</th>
    <th>Fixed version</th>
    <th>Vulnerability Count</th>
  </tr>
  {{ range $rowIndex, $element := . }}
  {{ if eq (len $element.CalledVulns) 0 }}
  {{ continue }}
  {{ end }}

  {{ $index := uniqueID }}
  <tr class='vuln-tr' id="vuln-tr-{{ $index }}">
    <td class="icon-td">
      <div class="expand-icon" onclick="showPackageDetails('{{ $index }}')">
        <i class="material-icons">play_arrow</i>
      </div>
    </td>
    <td>{{ $element.Name }}</td>
    <td>{{ $element.Ecosystem }}</td>
    <td>{{ $element.InstalledVersion }}</td>
    {{ if ne $element.HTMLVulnCount.UnFixed 0 }}
    {{ if eq $element.HTMLVulnCount.Fixed 0}}
    <td class="warning">
      {{ $element.FixedVersion }}
    </td>
    {{ else }}
    <td class="warning">
      {{ $element.FixedVersion }} (fixes {{ $element.HTMLVulnCount.Fixed }}/{{ $element.HTMLVulnCount.Called }})
    </td>
    {{ end }}
    {{ else }}
    <td>
      {{ $element.FixedVersion }}
    </td>
    {{ end }}
    <td>{{ printSeverityCountShort $element.HTMLVulnCount }}</td>
  </tr>
  <tr>
    <td colspan="100%">
      <div id="vuln-details-{{ $index }}" class="vuln-details">
        <p><span class="package-detail-title">Layer Command:</span> {{ $element.HTMLPackageDetail.LayerCommand }}</p>
        <p><span class="package-detail-title">Layer ID:</span> {{ $element.HTMLPackageDetail.LayerID }}</p>
        <p><span class="package-detail-title">In Base Image:</span> {{ $element.HTMLPackageDetail.InBaseImage }}</p>
        {{ template "vuln_table_template.html" $element.CalledVulns }}
        <!-- <p><strong>Source: {{ $element.Source }}</strong></p>
        <p>Vulnerabilities:</p>
        {{ range $index, $vuln := $element.CalledVulns }}
        {{ if eq $vuln.Summary.FixedVersion "No fix available" }}
        <p><a href="https://osv.dev/{{ $vuln.Summary.ID }}">{{ $vuln.Summary.ID }}</a>
          ({{$vuln.Summary.SeverityRating}}) has no fix available</p>
        {{ else }}
        <p><a href="https://osv.dev/{{ $vuln.Summary.ID }}">{{ $vuln.Summary.ID }}</a>
          ({{$vuln.Summary.SeverityRating}}) has a fixed version at {{$vuln.Summary.FixedVersion}}</p>
        {{ end }}
        {{ end }} -->
      </div>
    </td>
  </tr>
  {{ end }}
</table>
